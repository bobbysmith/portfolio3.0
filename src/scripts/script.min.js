'use strict';var background=document.querySelector('.background'),row=document.querySelector('.row'),ruleSet=document.querySelector('.rule'),newRuleButton=document.querySelector('.new-rule__button'),rulesIcon=[[1,1,1],[1,1,0],[1,0,1],[1,0,0],[0,1,1],[0,1,0],[0,0,1],[0,0,0]],ruleNumber;function generateAutomata(){ruleNumber=Math.floor(Math.random()*256)+0,background.innerHTML='',ruleSet.innerHTML='The background is cellular automata <a href="http://atlas.wolfram.com/01/01/'+ruleNumber+'/">rule '+ruleNumber+'</a>.';var a=document.createElement('div');a.setAttribute('class','row'),background.appendChild(a);for(var c,b=1;b<background.clientWidth/8;b++)c=document.createElement('div'),a.appendChild(c);randomizeRow(a);for(var d=1;d<background.clientHeight/8;d++)duplicateRow()}function numbertoBooleanArray(a){var c=[];for(var b=(+a).toString(2);8>b.length;)b=0+b;for(var d=0;d<b.length;d++)c.push(!!parseInt(b[d]));return c}function binary(){return Math.floor(2*Math.random())}function randomizeRow(a){for(var c,b=0;b<a.childNodes.length;b++)c=a.childNodes[b],c.classList.add(binary()?'active':'inactive')}function duplicateRow(){var a=document.querySelectorAll('.row'),b=a[a.length-1],c=b.cloneNode(!0);document.querySelector('.background').appendChild(c),processRow(c,b)}function processRow(a,b){for(var c=0;c<a.childNodes.length;c++)for(var d=a.childNodes[c],e=b.childNodes[c],f=e.previousElementSibling||b.childNodes[b.childNodes.length-1],g=e.nextElementSibling||b.childNodes[0],h=setActiveIfMatchesRule.bind(null,d,f,e,g),k=0;k<rulesIcon.length;k++)h(rulesIcon[k],numbertoBooleanArray(ruleNumber)[k])}function setActiveIfMatchesRule(a,b,c,d,e,f){var g=state(b)===e[0]&&state(c)===e[1]&&state(d)===e[2];g&&toggleActive(a,f)}function state(a){return a.classList.contains('active')?1:0}function toggleActive(a,b){b?(a.classList.remove('inactive'),a.classList.add('active')):(a.classList.remove('active'),a.classList.add('inactive'))}generateAutomata(),newRuleButton.addEventListener('click',generateAutomata);